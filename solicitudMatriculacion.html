<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solicitud de Matriculación</title>
    <link rel="stylesheet" href="css.css">
</head>
<body>
    <div class="top-info-bar">
        <p> Av. El Retorno 5-130 y Av. Ricardo Sánchez, Ibarra, Ecuador | uevmg@gmail.com</p>
    </div>
    <header>
        <div class="header-top">
            <img src="unidad-educativa-logo.png" alt="Logo de la Institución" class="logo">
            <div class="header-text">
                <h1>Unidad Educativa "Victor Manuel Guzman"</h1>
                <p>50 años de Educación Estudiantil</p>
            </div>
            <div class="auth-links">
                <a href="registro.html">Registrarse</a>
                <a href="login.html">Iniciar Sesión</a>
            </div>
        </div>
        <nav>
            <ul class="menu">
                <li><a href="index.html">Inicio</a></li>
                <li class="dropdown">
                    <a href="#">Institución</a>
                    <ul class="submenu">
                        <li><a href="autoridades.html">Autoridades</a></li>
                        <li><a href="index.html#consejo">Consejo Ejecutivo</a></li>
                        <li><a href="index.html#historia">Historia</a></li>
                        <li><a href="index.html#patrono">Patrono</a></li>
                        <li><a href="index.html#uniforme">Uniforme</a></li>
                        <li><a href="index.html#himno">Himno</a></li>
                        <li><a href="index.html#datos">Datos Informativos</a></li>
                    </ul>
                </li>
                <li><a href="index.html#docentes">Docentes</a></li>
                <li><a href="index.html#dece">DECE</a></li>
                <li><a href="index.html#recursos">Recursos Didácticos</a></li>
                <li><a href="index.html#fotos">Fotos</a></li>
                <li><a href="ubicacion.html">Ubicación</a></li>
                <li class="dropdown">
                    <a href="#">Registro</a>
                    <ul class="submenu">
                        <li><a href="matriculacion.html" target="_blank">Matriculación</a></li>
                        <li><a href="requisitos.html" target="_blank">Requisitos</a></li>
                    </ul>
                </li>
            </ul>
        </nav>
    </header>
    <main>
        <section class="centered-section">
            <h2>Solicitudes de Matriculación</h2>
            <div id="solicitudes-container">
                <!-- Las solicitudes se cargarán aquí dinámicamente -->
            </div>
        </section>
    </main>
    <script>
        // Función para inicializar Google Maps
        function initGoogleMaps() {
            const solicitudesContainer = document.getElementById("solicitudes-container");
            const solicitudes = JSON.parse(localStorage.getItem("solicitudesMatriculacion")) || [];

            if (solicitudes.length === 0) {
                solicitudesContainer.innerHTML = "<p>No hay solicitudes registradas.</p>";
            } else {
                solicitudes.forEach((solicitud, index) => {
                    const solicitudDiv = document.createElement("div");
                    solicitudDiv.classList.add("solicitud");

                    // Validar y convertir las coordenadas
                    const latitud = parseFloat(solicitud.latitud);
                    const longitud = parseFloat(solicitud.longitud);

                    // Proveer valores predeterminados si las coordenadas no son válidas
                    const coordenadasValidas = !isNaN(latitud) && !isNaN(longitud);
                    const ubicacion = coordenadasValidas
                        ? { lat: latitud, lng: longitud }
                        : { lat: 0.336164, lng: -78.116049 }; // Coordenadas predeterminadas

                    solicitudDiv.innerHTML = `
                        <div class="solicitud-header">
                            <h3>Solicitud #${index + 1}</h3>
                            <button class="toggle-btn" data-index="${index}">▼</button>
                        </div>
                        <div class="solicitud-content" id="solicitud-content-${index}" style="display: none;">
                            <p><strong>Código:</strong> ${solicitud.codigo}</p>
                            <p><strong>Usuario:</strong> ${solicitud.email}</p>
                            <h4>Datos del Estudiante</h4>
                            <p><strong>Apellidos:</strong> ${solicitud.apellidos}</p>
                            <p><strong>Nombres:</strong> ${solicitud.nombres}</p>
                            <p><strong>Provincia de Nacimiento:</strong> ${solicitud["provincia-nacimiento"]}</p>
                            <p><strong>Cantón:</strong> ${solicitud.canton}</p>
                            <p><strong>Género:</strong> ${solicitud.genero}</p>
                            <p><strong>Fecha de Nacimiento:</strong> ${solicitud["fecha-nacimiento"]}</p>
                            <p><strong>Nacionalidad:</strong> ${solicitud.nacionalidad}</p>
                            <p><strong>Institución:</strong> ${solicitud.institucion}</p>
                            <h4>Datos de la Vivienda</h4>
                            <p><strong>Provincia:</strong> ${solicitud.provincia}</p>
                            <p><strong>Ciudad:</strong> ${solicitud.ciudad}</p>
                            <p><strong>Parroquia:</strong> ${solicitud.parroquia}</p>
                            <p><strong>Dirección:</strong> ${solicitud.direccion}</p>
                            <p><strong>Teléfono:</strong> ${solicitud.telefono}</p>
                            <h4>Contacto de Emergencia</h4>
                            <p><strong>Nombres y Apellidos:</strong> ${solicitud["emergencia-nombres"]}</p>
                            <p><strong>Parentesco:</strong> ${solicitud["emergencia-parentesco"]}</p>
                            <h4>Datos de los Familiares</h4>
                            <h5>Padre</h5>
                            <p><strong>Apellidos y Nombres:</strong> ${solicitud["padre-nombre"]}</p>
                            <p><strong>Cédula:</strong> ${solicitud["padre-cedula"]}</p>
                            <p><strong>Teléfono:</strong> ${solicitud["padre-telefono"]}</p>
                            <p><strong>Profesión:</strong> ${solicitud["padre-profesion"]}</p>
                            <p><strong>Email:</strong> ${solicitud["padre-email"]}</p>
                            <h5>Madre</h5>
                            <p><strong>Apellidos y Nombres:</strong> ${solicitud["madre-nombre"]}</p>
                            <p><strong>Cédula:</strong> ${solicitud["madre-cedula"]}</p>
                            <p><strong>Teléfono:</strong> ${solicitud["madre-telefono"]}</p>
                            <p><strong>Profesión:</strong> ${solicitud["madre-profesion"]}</p>
                            <p><strong>Email:</strong> ${solicitud["madre-email"]}</p>
                            <h5>Representante Legal</h5>
                            <p><strong>Apellidos y Nombres:</strong> ${solicitud["representante-nombre"]}</p>
                            <p><strong>Cédula:</strong> ${solicitud["representante-cedula"]}</p>
                            <p><strong>Teléfono:</strong> ${solicitud["representante-telefono"]}</p>
                            <p><strong>Profesión:</strong> ${solicitud["representante-profesion"]}</p>
                            <p><strong>Email:</strong> ${solicitud["representante-email"]}</p>
                            <h4>Ubicación</h4>
                            <p><strong>Latitud:</strong> ${coordenadasValidas ? latitud : "N/A"}</p>
                            <p><strong>Longitud:</strong> ${coordenadasValidas ? longitud : "N/A"}</p>
                            <div id="map-${index}" style="width: 100%; height: 300px; border: 1px solid #ccc; margin-top: 1rem;"></div>
                        </div>
                    `;

                    solicitudesContainer.appendChild(solicitudDiv);

                    // Mostrar el mapa con la ubicación seleccionada
                    const map = new google.maps.Map(document.getElementById(`map-${index}`), {
                        center: ubicacion,
                        zoom: 15,
                    });

                    new google.maps.Marker({
                        position: ubicacion,
                        map: map,
                    });
                });

                // Agregar funcionalidad de minimizar/maximizar
                solicitudesContainer.addEventListener("click", (e) => {
                    if (e.target.classList.contains("toggle-btn")) {
                        const index = e.target.dataset.index;
                        const content = document.getElementById(`solicitud-content-${index}`);
                        const isVisible = content.style.display !== "none";
                        content.style.display = isVisible ? "none" : "block";
                        e.target.textContent = isVisible ? "▼" : "▲";
                    }
                });
            }
        }

        // Mostrar opciones de administración y autenticación
        document.addEventListener("DOMContentLoaded", () => {
            const authLinks = document.querySelector('.auth-links');
            const menu = document.querySelector('.menu');
            const usuarioActivo = localStorage.getItem('usuarioActivo');
            const adminEmail = localStorage.getItem('adminEmail') || 'admin@ejemplo.com'; // Valor predeterminado

            if (usuarioActivo) {
                authLinks.innerHTML = `
                    <a href="matricularse.html">Matricularse</a>
                    <a href="#" id="logout">Cerrar Sesión</a>
                `;
                document.getElementById('logout').addEventListener('click', () => {
                    localStorage.removeItem('usuarioActivo');
                    alert('Sesión cerrada exitosamente.');
                    window.location.href = 'index.html';
                });

                if (usuarioActivo === adminEmail) {
                    const adminMenuItem = document.createElement('li');
                    adminMenuItem.classList.add('dropdown');
                    adminMenuItem.innerHTML = `
                        <a href="#">Administración</a>
                        <ul class="submenu">
                            <li><a href="verUsuarios.html">Ver Usuarios</a></li>
                            <li><a href="solicitudMatriculacion.html">Solicitudes de Matriculación</a></li>
                        </ul>
                    `;
                    if (!menu.querySelector('a[href="verUsuarios.html"]')) {
                        menu.appendChild(adminMenuItem);
                    }
                }
            }
        });

        // Cargar el script de Google Maps y ejecutar la función de inicialización
        const script = document.createElement("script");
        script.src = `https://maps.googleapis.com/maps/api/js?key=AIzaSyASXHq4iXJSrxjYPatO4smsajz0BlH37JE&callback=initGoogleMaps`;
        script.async = true;
        script.defer = true;
        document.head.appendChild(script);
    </script>
    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>UNIDAD EDUCATIVA "VICTOR MANUEL GUZMAN"</h3>
                <div class="footer-line"></div>
                <p>Todos los contenidos digitales del portal web, se prohíbe su reproducción total, parcial y traducción a cualquier idioma sin autorización escrita por su titular.</p>
            </div>
            <div class="footer-section">
                <h3>ACCESOS DIRECTOS</h3>
                <div class="footer-line"></div>
                <ul>
                    <li><a href="index.html">Inicio</a></li>
                    <li><a href="registro.html">Registro</a></li>
                    <li><a href="autoridades.html">Autoridades</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>CONTACTOS</h3>
                <div class="footer-line"></div>
                <p>Av. El Retorno 5-130 y Av. Ricardo Sánchez, Ibarra, Ecuador</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>Unidad Educativa Victor Manuel Guzmán © Copyrights 2025 Diseñado por área de Informática</p>
        </div>
    </footer>
</body>
</html>
